<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Notas</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 16px }
        input { display:block; margin:8px 0; padding:8px; width:100% }
        #saveNote { padding:8px 12px }
        #notesContainer > div { border:10px solid #ddd; padding:8px; margin:8px 0 }
    </style>
</head>
<body>
    <h1>Minhas Notas</h1>
    <input type="text" id="noteTitle" placeholder="Título da nota">
    <input type="text" id="noteContent" placeholder="Conteúdo da nota">
    <button id="saveNote">Salvar Nota</button>
    <div id="notesContainer"></div>

    <script>
        const saveNoteButton = document.getElementById('saveNote');
        const noteTitleInput = document.getElementById('noteTitle');
        const noteContentInput = document.getElementById('noteContent');
        const notesContainer = document.getElementById('notesContainer');

        // Carrega notas do servidor
        fetch('/notes')
            .then(response => response.json())
            .then(data => {
                data.forEach(note => {
                    const created = note.creationDate ? new Date(note.creationDate).toLocaleString() : '';
                    createNoteDiv(note.title, note.content, created);
                });
        })
        .catch(err => console.error('Erro ao carregar notas:', err));

        saveNoteButton.addEventListener('click', () => {
            const title = noteTitleInput.value.trim();
            const content = noteContentInput.value.trim();

            if (!title || !content) {
                alert('Por favor, preencha ambos os campos para salvar a nota.');
                return;
            }

            fetch('/note', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, content })
            })
            .then(response => {
                if (!response.ok) throw new Error('Falha ao salvar nota');
                return response.json();
            })
            .then(savedNote => {
                const created = savedNote.creationDate ? new Date(savedNote.creationDate).toLocaleString() : new Date().toLocaleString();
                createNoteDiv(savedNote.title, savedNote.content, created);
                noteTitleInput.value = '';
                noteContentInput.value = '';
            })
            .catch(err => {
                console.error(err);
                alert('Não foi possível salvar a nota.');
            });
        });

        function createNoteDiv(title, content, creationDate) {
            const noteElement = document.createElement('div');
            noteElement.innerHTML = `<h3>${escapeHtml(title)}</h3><p>${escapeHtml(content)}</p><small>${escapeHtml(creationDate)}</small>`;
            notesContainer.appendChild(noteElement);
        }

        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }
    </script>
</body>
</html>